# 목차
1. 문제 설명

    1.1. Description

    1.2. Environment

2. 문제 파일 분석

    2.1. 코드 분석

    2.2. 실행 파일 분석

3. 문제 풀이 코드

## 1. 문제 설명

### 1.1. Description

이 문제는 서버에서 작동하고 있는 서비스(off_by_one_001)의 바이너리와 소스 코드가 주어집니다.

프로그램의 취약점을 찾고 익스플로잇해 get_shell 함수를 실행시키세요.

셸을 획득한 후, "flag" 파일을 읽어 워게임 사이트에 인증하면 점수를 획득할 수 있습니다.

플래그의 형식은 DH{...} 입니다.

### 1.2. Environment

Ubuntu 16.04

Arch:     i386-32-little

RELRO:    Partial RELRO

Stack:    No canary found

NX:       NX enabled
- *NX보호기법이란?*
    - *명칭*
        - *NX(No-eXecute) bit*
    - *특징*
        - *버퍼 오버플로우 보호 기법중 하나*
        - *스택, 힙과 같은 영역에서 코드가 실행되는 것을 막는 보호기법*
        - *nx 보호기법이 적용되어 있다면, shellcode를 실행할 수 없음*
    - *NX bit 설정 확인 명령어 : dmesg | grep NX*
    - *우회 방법*
        - *system함수를 호출하는 특정 함수의 주소로 ret를 변조*

PIE:      No PIE (0x8048000)

## 2. 문제 파일 분석

### 2.1. 코드 분석

`cat off_by_one_001.c`를 통해 코드를 확인
```
// off_by_one_001.c //

#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>

void alarm_handler()
{
    puts("TIME OUT");
    exit(-1);
}

void initialize()
{
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);

    signal(SIGALRM, alarm_handler);
    alarm(30);
}

void read_str(char *ptr, int size)
{
    int len;
    len = read(0, ptr, size);
    printf("%d", len);
    ptr[len] = '\0';
}

void get_shell()
{
    system("/bin/sh");
}

int main()
{
    char name[20];
    int age = 1;

    initialize();

    printf("Name: ");
    read_str(name, 20);

    printf("Are you baby?");

    if (age == 0)
    {
        get_shell();
    }
    else
    {
        printf("Ok, chance: \n");
        read(0, name, 20);
    }

    return 0;
}
```
- 주요 기능
    - `main`함수가 실행
    - 스택 메모리에 `name`변수명의 `20byte`의 공간을 할당
    - 스택 메모리에 `age`변수명의 `int`형 공간에 "1"을 할당
    - `read_str`함수를 통해 `name`을 입력 받음
        - `read_str`함수
    - 만약 `age`가 0이면 `get_shell`함수가 실행
        - `get_shell`함수
            `system`함수로 `/bin/sh`을 실행
    - 만약 `age`가 0이 아니면 `read`함수를 통해 `name`을 입력 받음

- 주의
 

- 발생 가능한 취약점




### 2.2. 실행 파일 분석

`gdb `를 통해 GNU 디버거를 실행

`disass main`를 통해 `main`함수의 어셈블리 확인
```

```



## 3. 문제 풀이 코드



- 쉘 실행 이후
    `find / -name "flag"`를 입력하여 플래그 파일을 검색
    
    `./flag`

    `cat ./flag`를 입력